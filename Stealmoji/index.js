(function(b,i,l,g,r,h,S,$,v){"use strict";const x=r.findByProps("convertSurrogateToName"),c=r.findByProps("hideActionSheet"),L=r.findByProps("openMediaModal"),C=r.findByProps("uploadEmoji"),D=r.findByProps("ActionSheet")?.ActionSheet??r.find(function(e){return e.render?.name==="ActionSheet"}),{ActionSheetTitleHeader:_,ActionSheetCloseButton:z}=r.findByProps("ActionSheetTitleHeader"),{BottomSheetFlatList:G}=r.findByProps("BottomSheetScrollView"),F=r.findByStoreName("EmojiStore"),k=r.findByStoreName("GuildStore"),U=r.findByStoreName("PermissionStore"),{default:O,GuildIconSizes:H}=r.findByProps("GuildIconSizes"),{downloadMediaAsset:V}=r.findByProps("downloadMediaAsset");function X(e){return new Promise(function(t,n){i.ReactNative.Image.getSize(e,function(a,o){t([a,o])},n)})}async function q(e){const[t,n]=await X(e),{width:a,height:o}=i.ReactNative.Dimensions.get("window");c.hideActionSheet(),L.openMediaModal({initialSources:[{uri:e,sourceURI:e,width:t,height:n}],initialIndex:0,originLayout:{width:128,height:128,x:a/2-64,y:o-64,resizeMode:"fill"}})}function I(e,t){fetch(e).then(function(n){n.blob().then(function(a){const o=new FileReader;o.readAsDataURL(a),o.onloadend=function(){t(o.result)}})})}const{FormRow:J,FormIcon:K}=g.Forms;function Q({guild:e,emojiNode:t}){const n=function(){$.showInputAlert({title:"Emoji name",initialValue:t.alt,placeholder:"bleh",onConfirm:function(o){I(t.src,function(d){C.uploadEmoji({guildId:e.id,image:d,name:o,roles:void 0}).then(function(){S.showToast(`Added ${t.alt} ${t.alt!==o?`as ${o} `:""}to ${e.name}`,h.getAssetIDByName("Check"))}).catch(function(s){S.showToast(s.body.message,h.getAssetIDByName("Small"))})})},confirmText:`Add to ${e.name}`,confirmColor:void 0,cancelText:"Cancel"}),c.hideActionSheet()},a=e.getMaxEmojiSlots?i.React.useMemo(function(){const o=e.getMaxEmojiSlots(),d=F.getGuilds()[e.id]?.emojis??[],s=t.src.includes(".gif");return d.filter(function(R){return R?.animated===s}).length<o},[]):!0;return i.React.createElement(J,{leading:i.React.createElement(O,{guild:e,size:H.MEDIUM,animate:!1}),disabled:!a,label:e.name,subLabel:a?void 0:"No slots available",trailing:i.React.createElement(K,{style:{opacity:1},source:h.getAssetIDByName("ic_add_24px")}),onPress:n})}const{FormDivider:W,FormIcon:Y}=g.Forms;function Z(e){const t=React.createElement(D,{scrollable:!0},React.createElement(g.ErrorBoundary,null,React.createElement(ee,{emojiNode:e})));c.openLazy(Promise.resolve({default:function(){return t}}),"AddToServerActionSheet")}function ee({emojiNode:e}){const t=Object.values(k.getGuilds()).filter(function(n){return U.can(i.constants.Permissions.MANAGE_GUILD_EXPRESSIONS,n)});return React.createElement(React.Fragment,null,React.createElement(_,{title:`Stealing ${e.alt}`,leading:React.createElement(Y,{style:{marginRight:12,opacity:1},source:{uri:e.src},disableColor:!0}),trailing:React.createElement(z,{onPress:function(){return c.hideActionSheet()}})}),React.createElement(G,{style:{flex:1},contentContainerStyle:{paddingBottom:24},data:t,renderItem:function({item:n}){return React.createElement(Q,{guild:n,emojiNode:e})},ItemSeparatorComponent:W,keyExtractor:function(n){return n.id}}))}const{Button:B}=r.findByProps("TableRow","Button");function j({emojiNode:e}){const t=[{text:"Add to Server",callback:function(){return Z(e)}},{text:"Copy URL to clipboard",callback:function(){i.clipboard.setString(e.src),c.hideActionSheet(),S.showToast(`Copied ${e.alt}'s URL to clipboard`,h.getAssetIDByName("ic_copy_message_link"))}},...i.ReactNative.Platform.select({ios:[{text:"Copy image to clipboard",callback:function(){return I(e.src,function(n){i.clipboard.setImage(n.split(",")[1]),c.hideActionSheet(),S.showToast(`Copied ${e.alt}'s image to clipboard`,h.getAssetIDByName("ic_message_copy"))})}}],default:[]}),{text:`Save image to ${i.ReactNative.Platform.select({android:"Downloads",default:"Camera Roll"})}`,callback:function(){V(e.src,e.src.includes(".gif")?1:0),c.hideActionSheet(),S.showToast(`Saved ${e.alt}'s image to ${i.ReactNative.Platform.select({android:"Downloads",default:"Camera Roll"})}`,h.getAssetIDByName("toast_image_saved"))}}];return React.createElement(React.Fragment,null,t.map(function({text:n,callback:a}){return React.createElement(B,{color:B.Colors?.BRAND,text:n,size:B.Sizes?.SMALL,onPress:a,style:{marginTop:i.ReactNative.Platform.select({android:12,default:16})}})}))}const{TouchableOpacity:te}=g.General,w=r.findByProps("GuildDetails");function ne(){if(w)return M("default",w);const e=[],t=l.before("openLazy",c,function([n,a]){a==="MessageEmojiActionSheet"&&(t(),n.then(function(o){e.push(l.after("default",o,function(d,s){e.push(M("type",s,!0))}))}))});return function(){return t(),e.forEach(function(n){return n?.()})}}function M(e,t,n=!1){const a=l.after(e,t,function([{emojiNode:o}],d){if(i.React.useEffect(function(){return function(){return void(n&&a())}},[]),!o.src)return;const s=d?.props?.children?.props?.children;if(!s)return;const R=l.after("type",s,function(T,m){i.React.useEffect(function(){return R},[]);const P=function(u){return u?.props?.source?.uri},y=v.findInReactTree(m,function(u){return u?.find?.(P)}),p=y?.findIndex?.(P)??-1;p>=0&&(y[p]=i.React.createElement(te,{onPress:function(){return q(o.src.split("?")[0])}},y[p]));const E=function(u){return u?.type?.name==="Button"},A=v.findInReactTree(m,function(u){return u?.find?.(E)}),f=A?.findLastIndex?.(E)??-1;f>=0?A.splice(f+1,0,i.React.createElement(j,{emojiNode:o})):m?.props?.children?.push?.(i.React.createElement(j,{emojiNode:o}))})});return a}function ie(e){let t;return function(){return t??=e()}}const oe=ie(function(){const{MessagesHandlers:e}=r.findByProps("MessagesHandlers"),t=new e(function(){});return t.isModalOrActionsheetObstructing=function(){return c.hideActionSheet()},function(n){return t.handleTapEmoji({nativeEvent:{node:n}})}});function ae({id:e,name:t,animated:n}){try{oe()(e?{id:e,alt:t,src:`https://cdn.discordapp.com/emojis/${e}.${n?"gif":"webp"}?size=128`}:{content:x.convertSurrogateToName(t),surrogate:t})}catch(a){console.log("Failed to open action sheet",a)}}const{TouchableOpacity:re}=g.General;function ce(){return l.before("openLazy",c,function([e,t]){t=="MessageReactions"&&e.then(function(n){const a=l.after("default",n,function(o,d){i.React.useEffect(function(){return a},[]);const s=l.after("type",d?.props?.children,function(R,T){i.React.useEffect(function(){return s},[]);const m=l.after("type",T?.props?.header,function(P,y){i.React.useEffect(function(){return m},[]);const p=v.findInReactTree(y,function(f){return f?.props?.tabs?.length});if(!p)return;const{tabs:E,onSelect:A}=p.props;p.props.tabs=E.map(function(f){return i.React.createElement(re,{onPress:function(){return A(f.props.index)},onLongPress:function(){const{emoji:u}=f.props.reaction;ae(u)}},f)})})})})})})}let N=[];var se={onLoad:function(){N.push(ne()),N.push(ce())},onUnload:function(){for(const e of N)e()}};return b.default=se,Object.defineProperty(b,"__esModule",{value:!0}),b})({},vendetta.metro.common,vendetta.patcher,vendetta.ui.components,vendetta.metro,vendetta.ui.assets,vendetta.ui.toasts,vendetta.ui.alerts,vendetta.utils);

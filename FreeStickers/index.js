(function(l,r,h,t,T,G,z,N,P){"use strict";const y=r.findByProps("canUseAnimatedEmojis"),F="canUseStickersEverywhere",S="canUseCustomStickersEverywhere",$=y[S]?S:F;function B(){return h.instead($,y,function(){return!0})}const{getChannel:I}=r.findByStoreName("ChannelStore"),x="https://media.discordapp.net/stickers/{stickerId}.{format}?size={size}";function L(e,n){if(!e.guild_id)return!0;const a=I(n).guild_id;return e.guild_id==a}function M(e){const n=e.format_type===4?"gif":"png";return x.replace("{stickerId}",e.id).replace("{format}",n).replace("{size}",t.storage.stickerSize.toString())}async function U(e){try{let n=new FormData;n.append("new-image-url",e);let a=await fetch("https://ezgif.com/apng-to-gif",{method:"POST",body:n});const i=a.url.split("/").pop();return n=new FormData,n.append("file",i),n.append("size",t.storage.stickerSize.toString()),a=await fetch(`https://ezgif.com/apng-to-gif/${i}?ajax=true`,{method:"POST",body:n}),`https:${(await a.text()).split('<img src="')[1].split('" style=')[0]}`}catch(n){return G.logger.error(`Failed to convert ${e} to GIF: `,n),null}}const f=new Map;function O(e,n){f.set(e,n),setTimeout(function(){return f.delete(e)},18e5)}function V(e){return f.get(e)}const{openAlert:_}=r.findByProps("openAlert","dismissAlert"),{AlertModal:v,AlertActionButton:d}=r.findByProps("AlertModal","AlertActions"),{Stack:D}=r.findByProps("Stack");function A(e){v&&d?j(e):z.showConfirmationAlert(e)}function j({title:e,content:n,confirmText:a,cancelText:i,onConfirm:E}){_(`vdarnfg-${e?.toLowerCase?.().replaceAll?.(" ","-")}`,React.createElement(v,{title:e,content:n,actions:React.createElement(D,null,React.createElement(d,{text:a,variant:"primary",onPress:E}),i?React.createElement(d,{text:i,variant:"secondary"}):React.createElement(React.Fragment,null))}))}function H(e){A({title:"APNG Sticker",content:`This sticker will be converted to a GIF using Ezgif and an Ezgif link will be sent in chat.
Do you want to continue?`,confirmText:"Continue",cancelText:"Cancel",onConfirm:e})}function K(e){A({title:"APNG conversion failed",content:[(e?"Instead of an animated GIF, raw APNG sticker will be sent in chat":"No stickers will be sent in chat")+", you can customize this behavior in plugin settings.","","Check debug logs for more information about the error."].join(`
`),confirmText:"OK"})}const b=r.findByProps("sendMessage","receiveMessage"),{getStickerById:q}=r.findByStoreName("StickersStore"),{getCurrentUser:J}=r.findByStoreName("UserStore");function Q(){return h.instead("sendStickers",b,function(e,n){if(!t.storage.ignoreNitro&&J?.().premiumType!==null)return n(...e);const[a,i,E,oe]=e,m=i.map(function(c){return q(c)}).filter(function(c){return!L(c,a)});if(!m.length)return n(...e);const C=async function(c){c&&(t.storage.ackedApng=!0);for(const u of m){let o=M(u);if(u.format_type===2&&t.storage.convertApng){let p=V(o);if(!p){T.showToast("Converting APNG sticker to GIF..");const k=await U(o);if(k)O(o,k);else if(K(t.storage.staticApngOnFail),!t.storage.staticApngOnFail)continue;p=k}o=p??o}t.storage.hyperlink&&u.name&&(o=`[${u.name}](${o})`),b.sendMessage(a,{content:o},null,oe)}};m.find(function(c){return c.format_type==2})&&!t.storage.ackedApng?H(function(){return C(!0)}):C()})}const{Stack:W,TableRadioGroup:X,TableRadioRow:Y,TableSwitchRow:s,TableRowGroup:w}=r.findByProps("TableRow","TableRowGroup"),{ScrollView:Z}=P.General,ee=r.findByName("HelpMessage"),te=[16,32,64,128,160,256,512,1024];t.storage.convertApng??=!0,t.storage.hyperlink??=!0,t.storage.stickerSize??=160;function ne(){return N.useProxy(t.storage),React.createElement(Z,{style:{flex:1},contentContainerStyle:{paddingBottom:38}},React.createElement(W,{style:{paddingVertical:24,paddingHorizontal:12},spacing:24},React.createElement(w,{title:"General"},React.createElement(s,{label:"Hyperlink stickers",value:t.storage.hyperlink,onValueChange:function(e){return t.storage.hyperlink=e}}),React.createElement(s,{label:"Ignore Nitro",subLabel:"Force FreeStickers even when you have Nitro",value:t.storage.ignoreNitro,onValueChange:function(e){return t.storage.ignoreNitro=e}})),React.createElement(w,{title:"APNG Stickers"},React.createElement(s,{label:"Convert APNG stickers to GIF",subLabel:"This is needed for stickers to be animated (uses Ezgif).",value:t.storage.convertApng,onValueChange:function(e){return t.storage.convertApng=e}}),React.createElement(s,{label:"Send static sticker if APNG conversion fails",value:t.storage.staticApngOnFail,onValueChange:function(e){return t.storage.staticApngOnFail=e}}),React.createElement(s,{label:"Show warning dialog for APNG stickers",subLabel:"This will only appear once",value:!t.storage.ackedApng,onValueChange:function(e){return t.storage.ackedApng=!e}})),React.createElement(X,{title:"Stickers Size",value:t.storage.stickerSize.toString(),onChange:function(e){return t.storage.stickerSize=parseInt(e)}},te.map(function(e){return React.createElement(Y,{label:e.toString(),subLabel:e==160?"Default":null,key:e.toString(),value:e.toString()})})),React.createElement(ee,{messageType:0},"Stickers size option does not work consistently at the moment.")))}let g;const re=function(){g&&R(),g=[B(),Q()]},R=function(){return g?.forEach?.(function(e){return e?.()})},ae=ne;return l.onLoad=re,l.onUnload=R,l.settings=ae,l})({},vendetta.metro,vendetta.patcher,vendetta.plugin,vendetta.ui.toasts,vendetta,vendetta.ui.alerts,vendetta.storage,vendetta.ui.components);

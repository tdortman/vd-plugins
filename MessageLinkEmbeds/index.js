(function(d,o,l,I){"use strict";const S=o.findByName("RowManager"),L=o.findByProps("getAPIBaseURL"),m=o.findByStoreName("ThemeStore"),{getChannel:U}=o.findByStoreName("ChannelStore"),{getGuild:$}=o.findByStoreName("GuildStore"),{resolveSemanticColor:v}=o.findByProps("colors","meta").meta,w=RegExp("(?<!<)https?:\\/\\/(?:\\w+\\.)?discord(?:app)?\\.com\\/channels\\/(\\d{17,20}|@me)\\/(\\d{17,20})\\/(\\d{17,20})","g"),r=new Map;let i,u;const B=vendetta.patcher.after("generate",S.prototype,function([t],a){if(t.rowType!==1)return;const s=t?.message?.content;if(!s)return;const P=s.match?.(w)?.map(function(n){const e=n.split("/").slice(-3);return{guildId:e[0]=="@me"?null:e[0],channelId:e[1],messageId:e[2],rawURL:n}});a.message.embeds??=[],P?.forEach(function(n){if(!r.has(n.messageId))return C(n.channelId,n.messageId).then(function(){return E(t.message)});const e=r.get(n.messageId);if(!e||a.message.renderContentOnly!=!1)return;const h=`https://cdn.discordapp.com/avatars/${e.author?.id}/${e.author?.avatar}.png`,T=new Date(e.timestamp).toLocaleString([],{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"}),c=n.guildId?$(n.guildId):null,g=c?.name,p=c?`https://cdn.discordapp.com/icons/${c.id}/${c.icon}.png`:null,f=U(n.channelId)?.name,y=`${f?"#"+f:""}${g?"  \u2022  "+g:""}`,R=y.length?y:null;a.message.embeds.push({type:"rich",author:{name:`${e.author?.global_name??e.author?.username}  \u2022  ${T}`,url:n.rawURL,iconURL:h,iconProxyURL:h},rawDescription:e.content,description:[{content:e.content,type:"text"}],fields:[],footer:{text:R,iconURL:p,iconProxyURL:p,content:R},bodyTextColor:N()})})}),x=function(){return B()};async function C(t,a){if(r.has(a))return;r.set(a,null);const s=(await L.get({url:`/channels/${t}/messages`,query:{limit:1,around:a},retries:2}).catch(function(){return null}))?.body?.[0];return r.set(a,s),s}function E(t){l.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{...t,content:t.content+"\u200B"},log_edit:!1})}function N(){return u==m.theme&&i||(u=m.theme,i=l.ReactNative.processColor(v(u,I.semanticColors.TEXT_NORMAL))),i}return d.onUnload=x,d})({},vendetta.metro,vendetta.metro.common,vendetta.ui);
